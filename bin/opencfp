#!/usr/bin/env php
<?php

set_time_limit(0);

require_once __DIR__ . '/../vendor/autoload.php';

use OpenCFP\Environment;
use OpenCFP\Console\Application;
use Symfony\Component\Console\Input\ArgvInput;
use OpenCFP\Application as ApplicationContainer;
use OpenCFP\Console\Command;
use OpenCFP\Domain\Services;

$basePath = realpath(dirname(__DIR__));
$input = new ArgvInput();
$environment = $input->getParameterOption(array('--env'), getenv('CFP_ENV') ?: 'development');

$container = new ApplicationContainer($basePath, Environment::fromString($environment));

$accountManagement = $container[Services\AccountManagement::class];

$app = new Application($container);

$app->addCommands([
    new Command\AdminDemoteCommand($accountManagement),
    new Command\AdminPromoteCommand($accountManagement),
    new Command\ReviewerDemoteCommand($accountManagement),
    new Command\ReviewerPromoteCommand($accountManagement),
    new Command\UserCreateCommand($accountManagement),
]);
$status = $app->run($input);

exit($status);
